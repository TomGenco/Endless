function Endless(){function E(){g=document.getElementsByTagName("canvas")[0];c=g.getContext("2d");d=Settings.Entries.dotSize.value;C();if("rainbow"==Settings.Entries.backgroundColor.value){var a=Math.floor(360*Math.random());x=new n(a,a+360,9E5)}p=new A([new w(.5,.25,0,0,"endless",256),new w(.5,.25,200,130,"By Tom Genco",64),new w(.5,.75,0,0,"Play",128,210,140,F)],!0);y=new A([new w(0,1,15,-15,"tomgenco.com",32,180,40,function(){window.location.href="http://tomgenco.com/"}),new w(1,1,-15,-15,"source code",
32,160,40,function(){window.location.href="http://github.com/TomGenco/Endless"})],!0);t=new A([new w(0,0,15,5,"Menu",64,140,70,G),new w(1,0,-15,5,"Score: 0",64)],!1);Settings.Entries.animateMenuObjects.value&&(p.menuObjects[0].transitions=[new n(0,1,2E3,0,"opacity")],p.menuObjects[1].transitions=[new n(0,1,2E3,500,"opacity")],p.menuObjects[2].transitions=[new n(0,1,2E3,1E3,"opacity")],y.menuObjects[0].transitions=[new n(0,1,2E3,2E3,"opacity")],y.menuObjects[1].transitions=[new n(0,1,2E3,2E3,"opacity")],
t.menuObjects[0].transitions=[new n(-100,t.menuObjects[0].fixedOffsetY,1E3,Settings.Entries.animateDots.value?1E3:0,"fixedOffsetY","logistic")],t.menuObjects[1].transitions=[new n(-100,t.menuObjects[1].fixedOffsetY,1E3,Settings.Entries.animateDots.value?1100:100,"fixedOffsetY","logistic")]);e=[p,y,t];u=Settings.Entries.columns.value*d*2-d;v=Settings.Entries.rows.value*d*2-d;p.startTransitions();y.startTransitions();requestAnimationFrame(D)}function H(){g.onmousemove=function(a){var b=a.clientX;a=
a.clientY;for(var f=!1,h=0;h<e.length;h++)for(var c=0;c<e[h].menuObjects.length;c++)e[h].visibility&&e[h].menuObjects[c].onClick&&e[h].menuObjects[c].inRange(b,a)&&(f=!0);f||z&&!p.visible&&b>q-u/2&&b<q+u/2&&a>r-v/2&&a<r+v/2&&1>=(b-q+u/2)/d%2&&1>=(a-r+v/2)/d%2?g.style.cursor="pointer":g.removeAttribute("style")};g.onmousedown=function(a){var b=a.clientX;a=a.clientY;for(var f=0;f<e.length;f++)for(var h=0;h<e[f].menuObjects.length;h++)if(e[f].visibility&&e[f].menuObjects[h].onClick&&e[f].menuObjects[h].inRange(b,
a))e[f].menuObjects[h].onClick()};g.onmouseup=function(a){g.removeAttribute("style")};g.onblur=function(a){g.removeAttribute("style")};window.onresize=C}function C(){g.setAttribute("width",window.innerWidth);g.setAttribute("height",window.innerHeight);q=window.innerWidth/2;r=window.innerHeight/2}function F(){if(!z){for(var a=0;a<Settings.Entries.columns.value;a++){l[a]=[];for(var b=0;b<Settings.Entries.rows.value;b++)l[a][b]=new I((Math.floor(Math.random()*Settings.Entries.dotColors.value)*(360/Settings.Entries.dotColors.value)+
Settings.Entries.hueShift.value)%360,a,b,q-u/2+d/2+a*d*2-q,r-v/2+d/2+b*d*2-r),Settings.Entries.animateDots.value&&(l[a][b].transitions=[new n(l[a][b].y-r-v/2-d/2,l[a][b].y,Settings.Entries.dotAnimationTime.value,Settings.Entries.dotAnimationTime.value/20*a,"y",Settings.Entries.dotAnimationType.value),new n(l[a][b].x-q-u/2-d/2,l[a][b].x,Settings.Entries.dotAnimationTime.value,Settings.Entries.dotAnimationTime.value/20*(Settings.Entries.rows.value-b-1),"x",Settings.Entries.dotAnimationType.value)])}z=
!0;t.visibility=!0;t.startTransitions()}B=!1;p.visibility=!1}function G(){B=!0;p.visibility=!0}function D(){Settings.Entries.acid.value&&(c.globalAlpha=.09);"rainbow"==Settings.Entries.backgroundColor.value?(x.started&&!x.finished||x.start(),c.fillStyle="hsl("+x.value%360+", 50%, 25%)"):c.fillStyle=Settings.Entries.backgroundColor.value;c.fillRect(0,0,g.width,g.height);Settings.Entries.acid.value&&(c.globalAlpha=1);if(z)for(var a=0;a<l.length;a++)for(var b=0;b<l[a].length;b++){if(Settings.Entries.dotSize.value!=
d){d=Settings.Entries.dotSize.value;for(var f=0;f<l.length;f++)for(var h=0;h<l[f].length;h++)l[f][h].recalculatePosition()}l[a][b].draw()}for(a=0;a<e.length;a++)e[a].visibility&&(B&&e[a]==p&&(c.fillStyle="rgba(0,0,0,.75)",c.fillRect(0,0,g.width,g.height)),e[a].draw());requestAnimationFrame(D)}var x,y,g,q,r,c,d,l=[],v,u,t,p,e,z,B,m=function(a,b){this._value=a;this.onChange=b;this.defaultValue=a;this.reset=function(){this._value=this.defaultValue}};Object.defineProperty(m.prototype,"value",{get:function(){return this._value},
set:function(a){this._value=a;if(void 0!==this.onChange)this.onChange(a)}});this.Settings={Entries:{},saveToStorage:function(){for(var a in this.Entries)this.Entries[a].value==this.Entries[a].defaultValue?localStorage.removeItem("ESett--"+a):localStorage.setItem("ESett--"+a,this.Entries[a].value)},loadFromStorage:function(){for(var a=window.localStorage,b,f=0;f<a.length;f++)if(/^ESett--/.test(a.key(f))){b=a.getItem(a.key(f));switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;
break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}try{this.Entries[a.key(f).substr(7)].defaultValue==b?localStorage.removeItem(a.key(f)):this.Entries[a.key(f).substr(7)].value=b}catch(h){console.warn('Setting "'+a.key(f).substr(7)+"\" from Local Storage doesn't exist")}}},toString:function(){var a="",b;for(b in this.Entries)a+=b+":"+this.Entries[b].value+";";return a.slice(0,-1)},loadFromString:function(a){a=a.split(";");for(var b,f=0;f<a.length;f++)if(""!=a){b=a[f].split(":")[1];switch(b){case "true":b=
!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}try{Settings.Entries[a[f].split(":")[0]].value=b}catch(h){console.warn('Setting "'+a[f].split(":")[0]+"\" from string doesn't exist")}}}};var I=function(a,b,f,h,g){this.color=a||0;this.col=b;this.row=f;this.x=h;this.y=g;this.opacity=1;this.transitions=[];this.recalculatePosition=function(){u=Settings.Entries.columns.value*d*2-d;v=Settings.Entries.rows.value*d*2-d;this.x=q-u/2+d/2+this.col*d*2-
q;this.y=r-v/2+d/2+this.row*d*2-r};this.draw=function(){for(var a=0;a<this.transitions.length;a++)this.transitions[a].started||this.transitions[a].start(),this.transitions[a].started&&!this.draw["finished"+this.transitions[a].property]&&(this[this.transitions[a].property]=this.transitions[a].value,this.transitions[a].finished&&(this.draw["finished"+this.transitions[a].property]=!0));c.fillStyle="hsla("+this.color+", 100%, 50%,"+this.opacity+")";c.beginPath();c.shadowColor="rgba(0,0,0,0)";c.arc(this.x+
q,this.y+r,d/2,0,2*Math.PI,!1);c.fill()}},w=function(a,b,f,h,d,e,l,m,n){this.relativeX=a;this.relativeY=b;this.fixedOffsetX=f;this.fixedOffsetY=h;this.text=d;this.fontSize=e;this.width=l;this.height=m;this.onClick=n;this.align=0==this.relativeX?"left":1==this.relativeX?"right":"center";this.baseline=0==this.relativeY?"top":1==this.relativeY?"bottom":"middle";this.opacity=1;this.transitions=[];this.inRange=function(k,c){var d=g.width*a+f,e=g.height*b+h;switch(this.align){default:console.error("invalid align for MenuObject "+
this.text+", using center");case "center":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return k>d-this.width/2&&k<d+this.width/2&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return k>d-this.width/2&&k<d+this.width/2&&c>e-this.height&&c<e?!0:!1;case "top":return k>d-this.width/2&&k<d+this.width/2&&c>e&&c<e+this.height?!0:!1}case "left":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+
this.text+", using middle");case "middle":return k>d&&k<d+this.width&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return k>d&&k<d+this.width&&c>e-this.height&&c<e?!0:!1;case "top":return k>d&&k<d+this.width&&c>e&&c<e+this.height?!0:!1}case "right":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return k>d-this.width&&k<d&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return k>d-this.width&&k<d&&c>e-this.height&&
c<e?!0:!1;case "top":return k>d-this.width&&k<d&&c>e&&c<e+this.height?!0:!1}}};this.draw=function(){if(Settings.Entries.animateMenuObjects.value)for(var a=0;a<this.transitions.length;a++)this.transitions[a].started&&!this.draw["finished"+this.transitions[a].property]&&(this[this.transitions[a].property]=this.transitions[a].value,this.transitions[a].finished&&(this.draw["finished"+this.transitions[a].property]=!0));a=this.fontSize/32+2;c.textAlign=this.align;c.textBaseline=this.baseline;c.font=(64<=
this.fontSize?"100 ":"300 ")+this.fontSize+"px Josefin Sans";c.shadowColor="black";c.shadowOffsetY=a;c.shadowOffsetX=a;c.shadowBlur=a;c.fillStyle="rgba(255, 255, 255, "+this.opacity+")";c.fillText(this.text,g.width*this.relativeX+this.fixedOffsetX,g.height*this.relativeY+this.fixedOffsetY)}},A=function(a,b){this.menuObjects=a;this.visibility=b;this.draw=function(){for(var a=0;a<this.menuObjects.length;a++)this.menuObjects[a].draw()};this.startTransitions=function(){for(var b=0;b<a.length;b++)for(var c=
0;c<a[b].transitions.length;c++)a[b].transitions[c].start()}},n=function(a,b,c,d,e,g){this.startVal=void 0===a?0:a;this.endVal=void 0===b?100:b;this.duration=c||1E3;this.delay=void 0===d?200:d;this.property=void 0===e?"opacity":e;this.motionType=void 0===g?"linear":g;this.started=this.finished=!1;this.delta=this.initTime=null;this.distance=this.endVal-this.startVal;this.start=function(){this.started=!0;this.finished=!1;var a=this;setTimeout(function(){a.finished=!0},a.delay+a.duration);this.initTime=
Date.now()}};Object.defineProperty(n.prototype,"value",{get:function(){var a;if(this.finished)return this.endVal;if(this.started){this.delta=Date.now()-this.delay-this.initTime;if(0>this.delta)return this.startVal;switch(this.motionType){default:console.error("Should be unreachable");case "linear":return a=this.delta/this.duration*this.distance+this.startVal,a>this.endVal?this.endVal:a;case "logistic":return 1/(1+Math.pow(Math.E,-15*(this.delta/this.duration-.5)))*this.distance+this.startVal}}else return this.startVal}});
(function(){var a=document.getElementsByTagName("h1")[0];a.removeAttribute("style");Settings.Entries={acid:new m(!1),animateDots:new m(!0),animateMenuObjects:new m(!0),backgroundColor:new m("rainbow"),columns:new m(10),dotAnimationTime:new m(1E3),dotAnimationType:new m("logistic"),dotColors:new m(10),dotSize:new m(40),hueShift:new m(70),rows:new m(10)};window.localStorage?Settings.loadFromStorage():console.error("This browser doesn't support Web Storage, so settings and statistics cannot be saved to browser.");
setTimeout(function(){E();H();a.setAttribute("style","display:none;")},300)})()}window.onload=Endless;
