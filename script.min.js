function Endless(){function D(){g=document.getElementsByTagName("canvas")[0];c=g.getContext("2d");d=Settings.Entries.dotSize;B();if("rainbow"==Settings.Entries.backgroundColor){var a=Math.floor(360*Math.random());w=new m(a,a+360,9E5)}n=new z([new v(.5,.25,0,0,"endless",256),new v(.5,.25,200,130,"By Tom Genco",64),new v(.5,.75,0,0,"Play",128,210,140,E)],!0);x=new z([new v(0,1,15,-15,"tomgenco.com",32,180,40,function(){window.location.href="http://tomgenco.com/"}),new v(1,1,-15,-15,"source code",32,
160,40,function(){window.location.href="http://github.com/TomGenco/Endless"})],!0);r=new z([new v(0,0,15,5,"Menu",64,140,70,F),new v(1,0,-15,5,"Score: 0",64)],!1);Settings.Entries.animateMenuObjects&&(n.menuObjects[0].transitions=[new m(0,1,2E3,0,"opacity")],n.menuObjects[1].transitions=[new m(0,1,2E3,500,"opacity")],n.menuObjects[2].transitions=[new m(0,1,2E3,1E3,"opacity")],x.menuObjects[0].transitions=[new m(0,1,2E3,2E3,"opacity")],x.menuObjects[1].transitions=[new m(0,1,2E3,2E3,"opacity")],r.menuObjects[0].transitions=
[new m(-100,r.menuObjects[0].fixedOffsetY,1E3,Settings.Entries.animateDots?1E3:0,"fixedOffsetY","logistic")],r.menuObjects[1].transitions=[new m(-100,r.menuObjects[1].fixedOffsetY,1E3,Settings.Entries.animateDots?1100:100,"fixedOffsetY","logistic")]);e=[n,x,r];t=Settings.Entries.columns*d*2-d;u=Settings.Entries.rows*d*2-d;n.startTransitions();x.startTransitions();requestAnimationFrame(C)}function G(){g.onmousemove=function(a){var b=a.clientX;a=a.clientY;for(var f=!1,h=0;h<e.length;h++)for(var c=0;c<
e[h].menuObjects.length;c++)e[h].visibility&&e[h].menuObjects[c].onClick&&e[h].menuObjects[c].inRange(b,a)&&(f=!0);f||y&&!n.visible&&b>p-t/2&&b<p+t/2&&a>q-u/2&&a<q+u/2&&1>=(b-p+t/2)/d%2&&1>=(a-q+u/2)/d%2?g.style.cursor="pointer":g.removeAttribute("style")};g.onmousedown=function(a){var b=a.clientX;a=a.clientY;for(var f=0;f<e.length;f++)for(var h=0;h<e[f].menuObjects.length;h++)if(e[f].visibility&&e[f].menuObjects[h].onClick&&e[f].menuObjects[h].inRange(b,a))e[f].menuObjects[h].onClick()};g.onmouseup=
function(a){g.removeAttribute("style")};g.onblur=function(a){g.removeAttribute("style")};window.onresize=B}function B(){g.setAttribute("width",window.innerWidth);g.setAttribute("height",window.innerHeight);p=window.innerWidth/2;q=window.innerHeight/2}function E(){if(!y){for(var a=0;a<Settings.Entries.columns;a++){k[a]=[];for(var b=0;b<Settings.Entries.rows;b++)k[a][b]=new H((Math.floor(Math.random()*Settings.Entries.dotColors)*(360/Settings.Entries.dotColors)+Settings.Entries.hueShift)%360,a,b,p-
t/2+d/2+a*d*2-p,q-u/2+d/2+b*d*2-q),Settings.Entries.animateDots&&(k[a][b].transitions=[new m(k[a][b].y-q-u/2-d/2,k[a][b].y,Settings.Entries.dotAnimationTime,Settings.Entries.dotAnimationTime/20*a,"y",Settings.Entries.dotAnimationType),new m(k[a][b].x-p-t/2-d/2,k[a][b].x,Settings.Entries.dotAnimationTime,Settings.Entries.dotAnimationTime/20*(Settings.Entries.rows-b-1),"x",Settings.Entries.dotAnimationType)])}y=!0;r.visibility=!0;r.startTransitions()}A=!1;n.visibility=!1}function F(){A=!0;n.visibility=
!0}function C(){Settings.Entries.acid&&(c.globalAlpha=.09);"rainbow"==Settings.Entries.backgroundColor?(w.started&&!w.finished||w.start(),c.fillStyle="hsl("+w.getVal()%360+", 50%, 25%)"):c.fillStyle=Settings.Entries.backgroundColor;c.fillRect(0,0,g.width,g.height);Settings.Entries.acid&&(c.globalAlpha=1);if(y)for(var a=0;a<k.length;a++)for(var b=0;b<k[a].length;b++){if(Settings.Entries.dotSize!=d){d=Settings.Entries.dotSize;for(var f=0;f<k.length;f++)for(var h=0;h<k[f].length;h++)k[f][h].recalculatePosition()}k[a][b].draw()}for(a=
0;a<e.length;a++)e[a].visibility&&(A&&e[a]==n&&(c.fillStyle="rgba(0,0,0,.75)",c.fillRect(0,0,g.width,g.height)),e[a].draw());requestAnimationFrame(C)}this.Settings={DefaultEntries:{acid:!1,animateDots:!0,animateMenuObjects:!0,backgroundColor:"rainbow",columns:10,dotAnimationTime:1E3,dotAnimationType:"logistic",dotColors:10,dotSize:40,hueShift:70,rows:10},Entries:{},saveToStorage:function(){for(var a in this.Entries)"DefaultEntries"!=a&&(this.Entries[a]==this.DefaultEntries[a]?localStorage.removeItem("ESett--"+
a):localStorage.setItem("ESett--"+a,this.Entries[a]))},loadFromStorage:function(){for(var a=window.localStorage,b,f=0;f<a.length;f++)if(/^ESett--/.test(a.key(f))){b=a.getItem(a.key(f));switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}this.DefaultEntries[a.key(f).substr(7)]==b?localStorage.removeItem(a.key(f)):this.Entries[a.key(f).substr(7)]=b}},toString:function(){var a="",b;for(b in this.Entries)"DefaultEntries"!=b&&
this.Entries[b]!=this.DefaultEntries[b]&&(a+=b+":"+this.Entries[b]+";");return a.trim()},loadFromString:function(a){a=a.split(";");for(var b,f=0;f<a.length-1;f++){b=a[f].split(":")[1];switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}Settings.Entries[a[f].split(":")[0]]=b}}};var w,x,g,p,q,c,d,k=[],u,t,r,n,e,y,A,H=function(a,b,f,h,g){this.color=a||0;this.col=b;this.row=f;this.x=h;this.y=g;this.opacity=1;this.transitions=
[];this.recalculatePosition=function(){t=Settings.Entries.columns*d*2-d;u=Settings.Entries.rows*d*2-d;this.x=p-t/2+d/2+this.col*d*2-p;this.y=q-u/2+d/2+this.row*d*2-q};this.draw=function(){for(var a=0;a<this.transitions.length;a++)this.transitions[a].started||this.transitions[a].start(),this.transitions[a].started&&!this.draw["finished"+this.transitions[a].property]&&(this[this.transitions[a].property]=this.transitions[a].getVal(),this.transitions[a].finished&&(this.draw["finished"+this.transitions[a].property]=
!0));c.fillStyle="hsla("+this.color+", 100%, 50%,"+this.opacity+")";c.beginPath();c.shadowColor="rgba(0,0,0,0)";c.arc(this.x+p,this.y+q,d/2,0,2*Math.PI,!1);c.fill()}},v=function(a,b,f,h,d,e,k,m,n){this.relativeX=a;this.relativeY=b;this.fixedOffsetX=f;this.fixedOffsetY=h;this.text=d;this.fontSize=e;this.width=k;this.height=m;this.onClick=n;this.align=0==this.relativeX?"left":1==this.relativeX?"right":"center";this.baseline=0==this.relativeY?"top":1==this.relativeY?"bottom":"middle";this.opacity=1;
this.transitions=[];this.inRange=function(l,c){var d=g.width*a+f,e=g.height*b+h;switch(this.align){default:console.error("invalid align for MenuObject "+this.text+", using center");case "center":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return l>d-this.width/2&&l<d+this.width/2&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return l>d-this.width/2&&l<d+this.width/2&&c>e-this.height&&c<e?!0:!1;case "top":return l>
d-this.width/2&&l<d+this.width/2&&c>e&&c<e+this.height?!0:!1}case "left":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return l>d&&l<d+this.width&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return l>d&&l<d+this.width&&c>e-this.height&&c<e?!0:!1;case "top":return l>d&&l<d+this.width&&c>e&&c<e+this.height?!0:!1}case "right":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+
", using middle");case "middle":return l>d-this.width&&l<d&&c>e-this.height/2&&c<e+this.height/2?!0:!1;case "bottom":return l>d-this.width&&l<d&&c>e-this.height&&c<e?!0:!1;case "top":return l>d-this.width&&l<d&&c>e&&c<e+this.height?!0:!1}}};this.draw=function(){if(Settings.Entries.animateMenuObjects)for(var a=0;a<this.transitions.length;a++)this.transitions[a].started&&!this.draw["finished"+this.transitions[a].property]&&(this[this.transitions[a].property]=this.transitions[a].getVal(),this.transitions[a].finished&&
(this.draw["finished"+this.transitions[a].property]=!0));a=this.fontSize/32+2;c.textAlign=this.align;c.textBaseline=this.baseline;c.font=(64<=this.fontSize?"100 ":"300 ")+this.fontSize+"px Josefin Sans";c.shadowColor="black";c.shadowOffsetY=a;c.shadowOffsetX=a;c.shadowBlur=a;c.fillStyle="rgba(255, 255, 255, "+this.opacity+")";c.fillText(this.text,g.width*this.relativeX+this.fixedOffsetX,g.height*this.relativeY+this.fixedOffsetY)}},z=function(a,b){this.menuObjects=a;this.visibility=b;this.draw=function(){for(var a=
0;a<this.menuObjects.length;a++)this.menuObjects[a].draw()};this.startTransitions=function(){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].transitions.length;c++)a[b].transitions[c].start()}},m=function(a,b,c,d,e,g){this.startVal=void 0===a?0:a;this.endVal=void 0===b?100:b;this.duration=c||1E3;this.delay=void 0===d?200:d;this.property=void 0===e?"opacity":e;this.motionType=void 0===g?"linear":g;this.started=this.finished=!1;var k,m,n=this.endVal-this.startVal;this.start=function(){this.started=!0;
this.finished=!1;var a=this;setTimeout(function(){a.finished=!0},a.delay+a.duration);k=Date.now()};this.getVal=function(){var a;if(this.finished)return this.endVal;if(this.started){m=Date.now()-this.delay-k;if(0>m)return this.startVal;switch(this.motionType){default:console.error("Should be unreachable");case "linear":return a=m/this.duration*n+this.startVal,a>b?b:a;case "logistic":return 1/(1+Math.pow(Math.E,-15*(m/this.duration-.5)))*n+this.startVal}}else return this.startVal}};(function(){for(var a in Settings.DefaultEntries)Settings.Entries[a]=
Settings.DefaultEntries[a];window.localStorage?Settings.loadFromStorage():console.error("This browser doesn't support Web Storage, so settings and statistics cannot be saved to browser.");D();G()})()}window.onload=Endless;
