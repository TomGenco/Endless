function Endless(){function H(){c=document.getElementsByTagName("canvas")[0];b=c.getContext("2d");F();if("rainbow"==Settings.backgroundColor){var a=Math.floor(360*Math.random());x=new n(a,a+360,9E5)}q=new C([new t(.5,.25,0,0,"Endless",256),new t(.5,.25,200,130,"By Tom Genco",64),new t(.5,.75,0,0,"Play",128,280,150,I)],!0);y=new C([new t(0,1,5,-5,"tomgenco.com",32,220,40,function(){window.location.href="http://tomgenco.com/"})],!0);y.menuObjects[0].align="left";y.menuObjects[0].baseline="bottom";k=
new C([new t(0,0,15,5,"Menu",64,170,70,J),new t(1,0,-15,5,"Score: 0",64)],!1);k.menuObjects[0].align="left";k.menuObjects[0].baseline="top";k.menuObjects[1].align="right";k.menuObjects[1].baseline="top";Settings.animateMenuObjects&&(q.transitionGroup=new A([new n(0,1,2E3),new n(0,1,2E3),new n(0,1,1E3)],"delay",750,"opacity"),y.transitionGroup=new A([new n(0,1,2E3,2E3)],"parallel",0,"opacity"),k.transitionGroup=new A([new n(-100,k.menuObjects[0].fixedOffsetY,1E3,Settings.animateDots?500:0,"logistic"),
new n(-100,k.menuObjects[1].fixedOffsetY,1E3,Settings.animateDots?600:100,"logistic")],"parallel",0,"fixedOffsetY"));f=[q,y,k];Settings.animateDots&&(u=new A([],"delay",Settings.dotAnimationTime/(Settings.columns*Settings.rows)));z=Settings.columns*Settings.dotSize*2-Settings.dotSize;v=Settings.rows*Settings.dotSize*2-Settings.dotSize;requestAnimationFrame(G)}function K(){c.onmousemove=function(a){var d=a.clientX;a=a.clientY;for(var m=!1,w=0;w<f.length;w++)for(var e=0;e<f[w].menuObjects.length;e++)f[w].visibility&&
f[w].menuObjects[e].onClick&&f[w].menuObjects[e].inRange(d,a)&&(m=!0);m||B&&!q.visible&&d>r-z/2&&d<r+z/2&&a>p-v/2&&a<p+v/2&&1>=(d-r+z/2)/Settings.dotSize%2&&1>=(a-p+v/2)/Settings.dotSize%2?c.style.cursor="pointer":c.removeAttribute("style")};c.onmousedown=function(a){var d=a.clientX;a=a.clientY;for(var m=0;m<f.length;m++)for(var c=0;c<f[m].menuObjects.length;c++)if(f[m].visibility&&f[m].menuObjects[c].onClick&&f[m].menuObjects[c].inRange(d,a))f[m].menuObjects[c].onClick()};c.onmouseup=function(a){c.removeAttribute("style")};
c.onblur=function(a){c.removeAttribute("style")};window.onresize=F}function F(){c.setAttribute("width",window.innerWidth);c.setAttribute("height",window.innerHeight);r=window.innerWidth/2;p=window.innerHeight/2}function I(){if(!B){for(var a=0;a<Settings.columns;a++){l[a]=[];for(var d=0;d<Settings.rows;d++)l[a][d]=new L((Math.floor(Math.random()*Settings.dotColors)*(360/Settings.dotColors)+Settings.hueShift)%360,a,d,r-z/2+Settings.dotSize/2+a*Settings.dotSize*2-r,p-v/2+Settings.dotSize/2+d*Settings.dotSize*
2-p),Settings.animateDots&&(u.transitions[a*Settings.rows+Settings.rows-d-1]=new n(l[a][d].y-p-v/2-Settings.dotSize/2,l[a][d].y,Settings.dotAnimationTime,0,Settings.dotAnimationType))}B=!0;k.visibility=!0}D=!1;q.visibility=!1}function J(){D=!0;q.visibility=!0}function G(){Settings.acid&&(b.globalAlpha=.09);"rainbow"==Settings.backgroundColor?(x.started&&!x.finished||x.start(),b.fillStyle="hsl("+x.getVal()%360+", 50%, 25%)"):b.fillStyle=Settings.backgroundColor;b.fillRect(0,0,c.width,c.height);Settings.acid&&
(b.globalAlpha=1);B&&E();for(var a=0;a<f.length;a++)f[a].visibility&&(D&&f[a]==q&&(b.fillStyle="rgba(0,0,0,.75)",b.fillRect(0,0,c.width,c.height)),f[a].draw());requestAnimationFrame(G)}function E(){if(!Settings.animateDots||E.finishedTransition)for(var a=0;a<l.length;a++)for(var d=0;d<l[a].length;d++)l[a][d].draw();else{u.started||u.start();for(a=0;a<l.length;a++)for(d=0;d<l[a].length;d++)l[a][d].y=u.transitions[a*Settings.rows+d].getVal(),l[a][d].draw();u.allFinished()&&(E.finishedTransition=!0)}}
this.Settings={Default:{acid:!1,animateDots:!0,animateMenuObjects:!0,backgroundColor:"rainbow",columns:10,dotAnimationTime:1E3,dotAnimationType:"logistic",dotColors:10,dotSize:40,hueShift:70,rows:10}};var x,y,c,r,p,b,u,l=[],v,z,k,q,f,B,D,L=function(a,d,m,c,e){this.color=a||0;this.col=d;this.row=m;this.x=c;this.y=e;this.draw=function(){b.fillStyle="hsl("+this.color+", 100%, 50%)";b.beginPath();b.arc(this.x+r,this.y+p,Settings.dotSize/2,0,2*Math.PI,!1);b.fill()}},t=function(a,d,m,f,e,l,k,n,M){this.relativeX=
a;this.relativeY=d;this.fixedOffsetX=m;this.fixedOffsetY=f;this.text=e;this.fontSize=l;this.width=k;this.height=n;this.onClick=M;this.align="center";this.baseline="middle";this.opacity=1;this.inRange=function(e,b){var g=c.width*a+m,h=c.height*d+f;switch(this.align){default:console.error("invalid align for MenuObject "+this.text+", using center");case "center":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return e>g-this.width/
2&&e<g+this.width/2&&b>h-this.height/2&&b<h+this.height/2?!0:!1;case "bottom":return e>g-this.width/2&&e<g+this.width/2&&b>h-this.height&&b<h?!0:!1;case "top":return e>g-this.width/2&&e<g+this.width/2&&b>h&&b<h+this.height?!0:!1}case "left":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return e>g&&e<g+this.width&&b>h-this.height/2&&b<h+this.height/2?!0:!1;case "bottom":return e>g&&e<g+this.width&&b>h-this.height&&b<h?!0:!1;
case "top":return e>g&&e<g+this.width&&b>h&&b<h+this.height?!0:!1}case "right":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return e>g-this.width&&e<g&&b>h-this.height/2&&b<h+this.height/2?!0:!1;case "bottom":return e>g-this.width&&e<g&&b>h-this.height&&b<h?!0:!1;case "top":return e>g-this.width&&e<g&&b>h&&b<h+this.height?!0:!1}}};this.draw=function(){b.textAlign=this.align;b.textBaseline=this.baseline;b.font=this.fontSize+
"px sans-serif";b.lineJoin="round";b.fillStyle="rgba(255, 255, 255, "+this.opacity+")";b.lineWidth=this.fontSize/12+3;b.strokeStyle="rgba(0, 0, 0, "+this.opacity+")";b.strokeText(this.text,c.width*this.relativeX+this.fixedOffsetX,c.height*this.relativeY+this.fixedOffsetY);b.fillText(this.text,c.width*this.relativeX+this.fixedOffsetX,c.height*this.relativeY+this.fixedOffsetY)}},C=function(a,b){this.menuObjects=a;this.visibility=b;this.transitionGroup=null;this.draw=function(){if(Settings.animateMenuObjects&&
(this.transitionGroup.started||this.transitionGroup.start(),!this.draw.finishedTransition)){for(var a=0;a<this.transitionGroup.transitions.length;a++)this.menuObjects[a][this.transitionGroup.property]=this.transitionGroup.transitions[a].getVal();this.transitionGroup.allFinished()&&(this.draw.finishedTransition=!0)}for(a=0;a<this.menuObjects.length;a++)this.menuObjects[a].draw()}},n=function(a,b,c,f,e){this.startVal=void 0===a?0:a;this.endVal=void 0===b?100:b;this.duration=c||1E3;this.delay=void 0===
f?200:f;this.motionType=void 0===e?"linear":e;this.started=this.finished=!1;var l,k,n=this.endVal-this.startVal;this.start=function(){this.started=!0;this.finished=!1;var a=this;setTimeout(function(){a.finished=!0},a.delay+a.duration);l=Date.now()};this.getVal=function(){var a;if(this.finished)return this.endVal;if(this.started){k=Date.now()-this.delay-l;if(0>k)return this.startVal;switch(this.motionType){default:console.error("Should be unreachable");case "linear":return a=k/this.duration*n+this.startVal,
a>b?b:a;case "logistic":return 1/(1+Math.pow(Math.E,-12*(k/this.duration-.5)))*n+this.startVal+2}}else return this.startVal}},A=function(a,b,c,f){this.transitions=a;this.started=!1;this.property=f;this.start=function(){this.started=!0;c=void 0===c?100:c;switch(b){case "parallel":for(var a=0;a<this.transitions.length;a++)this.transitions[a].start();break;case "delay":for(a=0;a<this.transitions.length;a++)this.transitions[a].delay+=c*a,this.transitions[a].start();break;default:case "series":for(a=0;a<
this.transitions.length;a++)0<a&&(this.transitions[a].delay+=this.transitions[a-1].duration+this.transitions[a-1].delay),this.transitions[a].start()}};this.allFinished=function(){return this.transitions[this.transitions.length-1].finished}};(function(){for(var a in Settings.Default)Settings[a]=Settings.Default[a];H();K()})()}window.onload=Endless;
