function Endless(){function G(){f=document.getElementsByTagName("canvas")[0];c=f.getContext("2d");E();if("rainbow"==Settings.Entries.backgroundColor){var a=Math.floor(360*Math.random());w=new n(a,a+360,9E5)}q=new B([new t(.5,.25,0,0,"Endless",256),new t(.5,.25,200,130,"By Tom Genco",64),new t(.5,.75,0,0,"Play",128,210,140,H)],!0);x=new B([new t(0,1,5,-5,"tomgenco.com",32,180,40,function(){window.location.href="http://tomgenco.com/"})],!0);x.menuObjects[0].align="left";x.menuObjects[0].baseline="bottom";
m=new B([new t(0,0,15,5,"Menu",64,140,70,I),new t(1,0,-15,5,"Score: 0",64)],!1);m.menuObjects[0].align="left";m.menuObjects[0].baseline="top";m.menuObjects[1].align="right";m.menuObjects[1].baseline="top";Settings.Entries.animateMenuObjects&&(q.transitionGroup=new z([new n(0,1,2E3),new n(0,1,2E3),new n(0,1,1E3)],"delay",750,"opacity"),x.transitionGroup=new z([new n(0,1,2E3,2E3)],"parallel",0,"opacity"),m.transitionGroup=new z([new n(-100,m.menuObjects[0].fixedOffsetY,1E3,Settings.Entries.animateDots?
500:0,"logistic"),new n(-100,m.menuObjects[1].fixedOffsetY,1E3,Settings.Entries.animateDots?600:100,"logistic")],"parallel",0,"fixedOffsetY"));g=[q,x,m];Settings.Entries.animateDots&&(u=new z([],"delay",Settings.Entries.dotAnimationTime/(Settings.Entries.columns*Settings.Entries.rows)));y=Settings.Entries.columns*Settings.Entries.dotSize*2-Settings.Entries.dotSize;v=Settings.Entries.rows*Settings.Entries.dotSize*2-Settings.Entries.dotSize;requestAnimationFrame(F)}function J(){f.onmousemove=function(a){var b=
a.clientX;a=a.clientY;for(var e=!1,c=0;c<g.length;c++)for(var d=0;d<g[c].menuObjects.length;d++)g[c].visibility&&g[c].menuObjects[d].onClick&&g[c].menuObjects[d].inRange(b,a)&&(e=!0);e||A&&!q.visible&&b>r-y/2&&b<r+y/2&&a>p-v/2&&a<p+v/2&&1>=(b-r+y/2)/Settings.Entries.dotSize%2&&1>=(a-p+v/2)/Settings.Entries.dotSize%2?f.style.cursor="pointer":f.removeAttribute("style")};f.onmousedown=function(a){var b=a.clientX;a=a.clientY;for(var e=0;e<g.length;e++)for(var c=0;c<g[e].menuObjects.length;c++)if(g[e].visibility&&
g[e].menuObjects[c].onClick&&g[e].menuObjects[c].inRange(b,a))g[e].menuObjects[c].onClick()};f.onmouseup=function(a){f.removeAttribute("style")};f.onblur=function(a){f.removeAttribute("style")};window.onresize=E}function E(){f.setAttribute("width",window.innerWidth);f.setAttribute("height",window.innerHeight);r=window.innerWidth/2;p=window.innerHeight/2}function H(){if(!A){for(var a=0;a<Settings.Entries.columns;a++){h[a]=[];for(var b=0;b<Settings.Entries.rows;b++)h[a][b]=new K((Math.floor(Math.random()*
Settings.Entries.dotColors)*(360/Settings.Entries.dotColors)+Settings.Entries.hueShift)%360,a,b,r-y/2+Settings.Entries.dotSize/2+a*Settings.Entries.dotSize*2-r,p-v/2+Settings.Entries.dotSize/2+b*Settings.Entries.dotSize*2-p),Settings.Entries.animateDots&&(u.transitions[a*Settings.Entries.rows+Settings.Entries.rows-b-1]=new n(h[a][b].y-p-v/2-Settings.Entries.dotSize/2,h[a][b].y,Settings.Entries.dotAnimationTime,0,Settings.Entries.dotAnimationType))}A=!0;m.visibility=!0}C=!1;q.visibility=!1}function I(){C=
!0;q.visibility=!0}function F(){Settings.Entries.acid&&(c.globalAlpha=.09);"rainbow"==Settings.Entries.backgroundColor?(w.started&&!w.finished||w.start(),c.fillStyle="hsl("+w.getVal()%360+", 50%, 25%)"):c.fillStyle=Settings.Entries.backgroundColor;c.fillRect(0,0,f.width,f.height);Settings.Entries.acid&&(c.globalAlpha=1);A&&D();for(var a=0;a<g.length;a++)g[a].visibility&&(C&&g[a]==q&&(c.fillStyle="rgba(0,0,0,.75)",c.fillRect(0,0,f.width,f.height)),g[a].draw());requestAnimationFrame(F)}function D(){if(!Settings.Entries.animateDots||
D.finishedTransition)for(var a=0;a<h.length;a++)for(var b=0;b<h[a].length;b++)h[a][b].draw();else{u.started||u.start();for(a=0;a<h.length;a++)for(b=0;b<h[a].length;b++)h[a][b].y=u.transitions[a*Settings.Entries.rows+b].getVal(),h[a][b].draw();u.allFinished()&&(D.finishedTransition=!0)}}this.Settings={DefaultEntries:{acid:!1,animateDots:!0,animateMenuObjects:!0,backgroundColor:"rainbow",columns:10,dotAnimationTime:1E3,dotAnimationType:"logistic",dotColors:10,dotSize:40,hueShift:70,rows:10},Entries:{},
saveToStorage:function(){for(var a in this.Entries)"DefaultEntries"!=a&&this.Entries[a]!=this.DefaultEntries[a]&&localStorage.setItem("ESett--"+a,this.Entries[a])},loadFromStorage:function(){for(var a=window.localStorage,b,e=0;e<a.length;e++)if(/^ESett--/.test(a.key(e))){b=a.getItem(a.key(e));switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}this.DefaultEntries[a.key(e).substr(7)]==b?localStorage.removeItem(a.key(e)):this.Entries[a.key(e).substr(7)]=
b}},toString:function(){var a="",b;for(b in this.Entries)"DefaultEntries"!=b&&this.Entries[b]!=this.DefaultEntries[b]&&(a+=b+":"+this.Entries[b]+";");return a.trim()},loadFromString:function(a){a=a.split(";");for(var b,e=0;e<a.length-1;e++){b=a[e].split(":")[1];switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}Settings.Entries[a[e].split(":")[0]]=b}}};var w,x,f,r,p,c,u,h=[],v,y,m,q,g,A,C,K=function(a,b,e,f,d){this.color=
a||0;this.col=b;this.row=e;this.x=f;this.y=d;this.draw=function(){c.fillStyle="hsl("+this.color+", 100%, 50%)";c.beginPath();c.shadowColor="rgba(0,0,0,0)";c.arc(this.x+r,this.y+p,Settings.Entries.dotSize/2,0,2*Math.PI,!1);c.fill()}},t=function(a,b,e,g,d,h,m,n,L){this.relativeX=a;this.relativeY=b;this.fixedOffsetX=e;this.fixedOffsetY=g;this.text=d;this.fontSize=h;this.width=m;this.height=n;this.onClick=L;this.align="center";this.baseline="middle";this.opacity=1;this.inRange=function(c,d){var k=f.width*
a+e,l=f.height*b+g;switch(this.align){default:console.error("invalid align for MenuObject "+this.text+", using center");case "center":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return c>k-this.width/2&&c<k+this.width/2&&d>l-this.height/2&&d<l+this.height/2?!0:!1;case "bottom":return c>k-this.width/2&&c<k+this.width/2&&d>l-this.height&&d<l?!0:!1;case "top":return c>k-this.width/2&&c<k+this.width/2&&d>l&&d<l+this.height?!0:
!1}case "left":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return c>k&&c<k+this.width&&d>l-this.height/2&&d<l+this.height/2?!0:!1;case "bottom":return c>k&&c<k+this.width&&d>l-this.height&&d<l?!0:!1;case "top":return c>k&&c<k+this.width&&d>l&&d<l+this.height?!0:!1}case "right":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return c>k-this.width&&c<
k&&d>l-this.height/2&&d<l+this.height/2?!0:!1;case "bottom":return c>k-this.width&&c<k&&d>l-this.height&&d<l?!0:!1;case "top":return c>k-this.width&&c<k&&d>l&&d<l+this.height?!0:!1}}};this.draw=function(){var a=this.fontSize/32+2;c.textAlign=this.align;c.textBaseline=this.baseline;c.font=(64<=this.fontSize?"100 ":"300 ")+this.fontSize+"px Josefin Sans";c.shadowColor="black";c.shadowOffsetY=a;c.shadowOffsetX=a;c.shadowBlur=a;c.fillStyle="rgba(255, 255, 255, "+this.opacity+")";c.fillText(this.text,
f.width*this.relativeX+this.fixedOffsetX,f.height*this.relativeY+this.fixedOffsetY)}},B=function(a,b){this.menuObjects=a;this.visibility=b;this.transitionGroup=null;this.draw=function(){if(Settings.Entries.animateMenuObjects&&(this.transitionGroup.started||this.transitionGroup.start(),!this.draw.finishedTransition)){for(var a=0;a<this.transitionGroup.transitions.length;a++)this.menuObjects[a][this.transitionGroup.property]=this.transitionGroup.transitions[a].getVal();this.transitionGroup.allFinished()&&
(this.draw.finishedTransition=!0)}for(a=0;a<this.menuObjects.length;a++)this.menuObjects[a].draw()}},n=function(a,b,c,f,d){this.startVal=void 0===a?0:a;this.endVal=void 0===b?100:b;this.duration=c||1E3;this.delay=void 0===f?200:f;this.motionType=void 0===d?"linear":d;this.started=this.finished=!1;var g,h,m=this.endVal-this.startVal;this.start=function(){this.started=!0;this.finished=!1;var a=this;setTimeout(function(){a.finished=!0},a.delay+a.duration);g=Date.now()};this.getVal=function(){var a;if(this.finished)return this.endVal;
if(this.started){h=Date.now()-this.delay-g;if(0>h)return this.startVal;switch(this.motionType){default:console.error("Should be unreachable");case "linear":return a=h/this.duration*m+this.startVal,a>b?b:a;case "logistic":return 1/(1+Math.pow(Math.E,-12*(h/this.duration-.5)))*m+this.startVal+2}}else return this.startVal}},z=function(a,b,c,f){this.transitions=a;this.started=!1;this.property=f;this.start=function(){this.started=!0;c=void 0===c?100:c;switch(b){case "parallel":for(var a=0;a<this.transitions.length;a++)this.transitions[a].start();
break;case "delay":for(a=0;a<this.transitions.length;a++)this.transitions[a].delay+=c*a,this.transitions[a].start();break;default:case "series":for(a=0;a<this.transitions.length;a++)0<a&&(this.transitions[a].delay+=this.transitions[a-1].duration+this.transitions[a-1].delay),this.transitions[a].start()}};this.allFinished=function(){return this.transitions[this.transitions.length-1].finished}};(function(){for(var a in Settings.DefaultEntries)Settings.Entries[a]=Settings.DefaultEntries[a];window.localStorage?
Settings.loadFromStorage():console.error("This browser doesn't support Web Storage, so settings and statistics cannot be saved to browser.");G();J()})()}window.onload=Endless;
