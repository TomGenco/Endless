function Endless(){function H(){d=document.getElementsByTagName("canvas")[0];c=d.getContext("2d");F();if("rainbow"==Settings.Entries.backgroundColor){var a=Math.floor(360*Math.random());x=new n(a,a+360,9E5)}q=new C([new t(.5,.25,0,0,"Endless",256),new t(.5,.25,200,130,"By Tom Genco",64),new t(.5,.75,0,0,"Play",128,280,150,I)],!0);y=new C([new t(0,1,5,-5,"tomgenco.com",32,220,40,function(){window.location.href="http://tomgenco.com/"})],!0);y.menuObjects[0].align="left";y.menuObjects[0].baseline="bottom";
m=new C([new t(0,0,15,5,"Menu",64,170,70,J),new t(1,0,-15,5,"Score: 0",64)],!1);m.menuObjects[0].align="left";m.menuObjects[0].baseline="top";m.menuObjects[1].align="right";m.menuObjects[1].baseline="top";Settings.Entries.animateMenuObjects&&(q.transitionGroup=new A([new n(0,1,2E3),new n(0,1,2E3),new n(0,1,1E3)],"delay",750,"opacity"),y.transitionGroup=new A([new n(0,1,2E3,2E3)],"parallel",0,"opacity"),m.transitionGroup=new A([new n(-100,m.menuObjects[0].fixedOffsetY,1E3,Settings.Entries.animateDots?
500:0,"logistic"),new n(-100,m.menuObjects[1].fixedOffsetY,1E3,Settings.Entries.animateDots?600:100,"logistic")],"parallel",0,"fixedOffsetY"));g=[q,y,m];Settings.Entries.animateDots&&(u=new A([],"delay",Settings.Entries.dotAnimationTime/(Settings.Entries.columns*Settings.Entries.rows)));z=Settings.Entries.columns*Settings.Entries.dotSize*2-Settings.Entries.dotSize;v=Settings.Entries.rows*Settings.Entries.dotSize*2-Settings.Entries.dotSize;requestAnimationFrame(G)}function K(){d.onmousemove=function(a){var b=
a.clientX;a=a.clientY;for(var f=!1,w=0;w<g.length;w++)for(var e=0;e<g[w].menuObjects.length;e++)g[w].visibility&&g[w].menuObjects[e].onClick&&g[w].menuObjects[e].inRange(b,a)&&(f=!0);f||B&&!q.visible&&b>r-z/2&&b<r+z/2&&a>p-v/2&&a<p+v/2&&1>=(b-r+z/2)/Settings.Entries.dotSize%2&&1>=(a-p+v/2)/Settings.Entries.dotSize%2?d.style.cursor="pointer":d.removeAttribute("style")};d.onmousedown=function(a){var b=a.clientX;a=a.clientY;for(var f=0;f<g.length;f++)for(var d=0;d<g[f].menuObjects.length;d++)if(g[f].visibility&&
g[f].menuObjects[d].onClick&&g[f].menuObjects[d].inRange(b,a))g[f].menuObjects[d].onClick()};d.onmouseup=function(a){d.removeAttribute("style")};d.onblur=function(a){d.removeAttribute("style")};window.onresize=F}function F(){d.setAttribute("width",window.innerWidth);d.setAttribute("height",window.innerHeight);r=window.innerWidth/2;p=window.innerHeight/2}function I(){if(!B){for(var a=0;a<Settings.Entries.columns;a++){h[a]=[];for(var b=0;b<Settings.Entries.rows;b++)h[a][b]=new L((Math.floor(Math.random()*
Settings.Entries.dotColors)*(360/Settings.Entries.dotColors)+Settings.Entries.hueShift)%360,a,b,r-z/2+Settings.Entries.dotSize/2+a*Settings.Entries.dotSize*2-r,p-v/2+Settings.Entries.dotSize/2+b*Settings.Entries.dotSize*2-p),Settings.Entries.animateDots&&(u.transitions[a*Settings.Entries.rows+Settings.Entries.rows-b-1]=new n(h[a][b].y-p-v/2-Settings.Entries.dotSize/2,h[a][b].y,Settings.Entries.dotAnimationTime,0,Settings.Entries.dotAnimationType))}B=!0;m.visibility=!0}D=!1;q.visibility=!1}function J(){D=
!0;q.visibility=!0}function G(){Settings.Entries.acid&&(c.globalAlpha=.09);"rainbow"==Settings.Entries.backgroundColor?(x.started&&!x.finished||x.start(),c.fillStyle="hsl("+x.getVal()%360+", 50%, 25%)"):c.fillStyle=Settings.Entries.backgroundColor;c.fillRect(0,0,d.width,d.height);Settings.Entries.acid&&(c.globalAlpha=1);B&&E();for(var a=0;a<g.length;a++)g[a].visibility&&(D&&g[a]==q&&(c.fillStyle="rgba(0,0,0,.75)",c.fillRect(0,0,d.width,d.height)),g[a].draw());requestAnimationFrame(G)}function E(){if(!Settings.Entries.animateDots||
E.finishedTransition)for(var a=0;a<h.length;a++)for(var b=0;b<h[a].length;b++)h[a][b].draw();else{u.started||u.start();for(a=0;a<h.length;a++)for(b=0;b<h[a].length;b++)h[a][b].y=u.transitions[a*Settings.Entries.rows+b].getVal(),h[a][b].draw();u.allFinished()&&(E.finishedTransition=!0)}}this.Settings={DefaultEntries:{acid:!1,animateDots:!0,animateMenuObjects:!0,backgroundColor:"rainbow",columns:10,dotAnimationTime:1E3,dotAnimationType:"logistic",dotColors:10,dotSize:40,hueShift:70,rows:10},Entries:{},
saveToStorage:function(){for(var a in this.Entries)"DefaultEntries"!=a&&this.Entries[a]!=this.DefaultEntries[a]&&localStorage.setItem("ESett--"+a,this.Entries[a])},loadFromStorage:function(){for(var a=window.localStorage,b,f=0;f<a.length;f++)if(/^ESett--/.test(a.key(f))){b=a.getItem(a.key(f));switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}this.DefaultEntries[a.key(f).substr(7)]==b?localStorage.removeItem(a.key(f)):this.Entries[a.key(f).substr(7)]=
b}},toString:function(){var a="",b;for(b in this.Entries)"DefaultEntries"!=b&&this.Entries[b]!=this.DefaultEntries[b]&&(a+=b+":"+this.Entries[b]+";");return a.trim()},loadFromString:function(a){a=a.split(";");for(var b,f=0;f<a.length-1;f++){b=a[f].split(":")[1];switch(b){case "true":b=!0;break;case "false":b=!1;break;case "null":b=null;break;default:b=isNaN(parseFloat(b))?b:parseFloat(b)}Settings.Entries[a[f].split(":")[0]]=b}}};var x,y,d,r,p,c,u,h=[],v,z,m,q,g,B,D,L=function(a,b,f,d,e){this.color=
a||0;this.col=b;this.row=f;this.x=d;this.y=e;this.draw=function(){c.fillStyle="hsl("+this.color+", 100%, 50%)";c.beginPath();c.arc(this.x+r,this.y+p,Settings.Entries.dotSize/2,0,2*Math.PI,!1);c.fill()}},t=function(a,b,f,g,e,h,m,n,M){this.relativeX=a;this.relativeY=b;this.fixedOffsetX=f;this.fixedOffsetY=g;this.text=e;this.fontSize=h;this.width=m;this.height=n;this.onClick=M;this.align="center";this.baseline="middle";this.opacity=1;this.inRange=function(e,c){var k=d.width*a+f,l=d.height*b+g;switch(this.align){default:console.error("invalid align for MenuObject "+
this.text+", using center");case "center":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return e>k-this.width/2&&e<k+this.width/2&&c>l-this.height/2&&c<l+this.height/2?!0:!1;case "bottom":return e>k-this.width/2&&e<k+this.width/2&&c>l-this.height&&c<l?!0:!1;case "top":return e>k-this.width/2&&e<k+this.width/2&&c>l&&c<l+this.height?!0:!1}case "left":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+
this.text+", using middle");case "middle":return e>k&&e<k+this.width&&c>l-this.height/2&&c<l+this.height/2?!0:!1;case "bottom":return e>k&&e<k+this.width&&c>l-this.height&&c<l?!0:!1;case "top":return e>k&&e<k+this.width&&c>l&&c<l+this.height?!0:!1}case "right":switch(this.baseline){default:console.error("invalid baseline for MenuObject "+this.text+", using middle");case "middle":return e>k-this.width&&e<k&&c>l-this.height/2&&c<l+this.height/2?!0:!1;case "bottom":return e>k-this.width&&e<k&&c>l-this.height&&
c<l?!0:!1;case "top":return e>k-this.width&&e<k&&c>l&&c<l+this.height?!0:!1}}};this.draw=function(){c.textAlign=this.align;c.textBaseline=this.baseline;c.font=this.fontSize+"px sans-serif";c.lineJoin="round";c.fillStyle="rgba(255, 255, 255, "+this.opacity+")";c.lineWidth=this.fontSize/12+3;c.strokeStyle="rgba(0, 0, 0, "+this.opacity+")";c.strokeText(this.text,d.width*this.relativeX+this.fixedOffsetX,d.height*this.relativeY+this.fixedOffsetY);c.fillText(this.text,d.width*this.relativeX+this.fixedOffsetX,
d.height*this.relativeY+this.fixedOffsetY)}},C=function(a,b){this.menuObjects=a;this.visibility=b;this.transitionGroup=null;this.draw=function(){if(Settings.Entries.animateMenuObjects&&(this.transitionGroup.started||this.transitionGroup.start(),!this.draw.finishedTransition)){for(var a=0;a<this.transitionGroup.transitions.length;a++)this.menuObjects[a][this.transitionGroup.property]=this.transitionGroup.transitions[a].getVal();this.transitionGroup.allFinished()&&(this.draw.finishedTransition=!0)}for(a=
0;a<this.menuObjects.length;a++)this.menuObjects[a].draw()}},n=function(a,b,c,d,e){this.startVal=void 0===a?0:a;this.endVal=void 0===b?100:b;this.duration=c||1E3;this.delay=void 0===d?200:d;this.motionType=void 0===e?"linear":e;this.started=this.finished=!1;var g,h,m=this.endVal-this.startVal;this.start=function(){this.started=!0;this.finished=!1;var a=this;setTimeout(function(){a.finished=!0},a.delay+a.duration);g=Date.now()};this.getVal=function(){var a;if(this.finished)return this.endVal;if(this.started){h=
Date.now()-this.delay-g;if(0>h)return this.startVal;switch(this.motionType){default:console.error("Should be unreachable");case "linear":return a=h/this.duration*m+this.startVal,a>b?b:a;case "logistic":return 1/(1+Math.pow(Math.E,-12*(h/this.duration-.5)))*m+this.startVal+2}}else return this.startVal}},A=function(a,b,c,d){this.transitions=a;this.started=!1;this.property=d;this.start=function(){this.started=!0;c=void 0===c?100:c;switch(b){case "parallel":for(var a=0;a<this.transitions.length;a++)this.transitions[a].start();
break;case "delay":for(a=0;a<this.transitions.length;a++)this.transitions[a].delay+=c*a,this.transitions[a].start();break;default:case "series":for(a=0;a<this.transitions.length;a++)0<a&&(this.transitions[a].delay+=this.transitions[a-1].duration+this.transitions[a-1].delay),this.transitions[a].start()}};this.allFinished=function(){return this.transitions[this.transitions.length-1].finished}};(function(){for(var a in Settings.DefaultEntries)Settings.Entries[a]=Settings.DefaultEntries[a];window.localStorage?
Settings.loadFromStorage():console.error("This browser doesn't support Web Storage, so settings and statistics cannot be saved to browser.");H();K()})()}window.onload=Endless;
